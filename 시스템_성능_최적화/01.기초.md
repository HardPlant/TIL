# 성능 기초

## 성능이란?

#### 파이프의 성능

* 시간당 보내는 물의 양

* 요소 : 물이 흐르는 속도, 파이프의 직경

#### 시스템의 성능

시간당 처리량

* 응답시간, 동시에 처리할 수 있는 프로세스 수

### 성능의 정의

고객의 특정 업무를 대상으로 운영환경하에서 고객이 수긍할 수 있는 응답시간 내에 처리할 수 있는 거래량

#### 용어

##### 동시 사용자

* 부하 : 동시 사용자

시스템과 접속을 유지하고 있는 사용자 수
동시에 시스템에 트랜잭션을 유발시키는 사용자

* 동시 사용자 : 요청 사용자 수 + 비요청 사용자 수

* 요청 사용자 수 : 요청을 보낸 후 기다리고 있는 사용자

* 비요청 사용자 수 : 서버에 요청을 보내고 있지 않은 사용자

##### 처리량

서버가 일정 시간 내에 처리한 트랜잭션의 양

고객 조회: 1 트랜잭션
서비스 요청자 입장 : 18(웹 자원)+App(6)+DB 처리(100) 트랜잭션

* 중요한 것

DB의 데이터 처리속도, 웹 서버/이미지의 처리 속도가 아니라 고객의 업무를 얼마나 빨리 처리가능한가

TPS의 T: 고객의 업무 처리 건수로 보는 것이 고객과의 의사소통, 업무 시스템 평가에 적합함

그 이외에 Page Per Sec, Hit Per Sec이 있음

* PPS : 화면 단위로 분석, 하지만 고객 입장에서는 1임

* HPS : 모든 이미지, 스크립트, 스타일, 컴포넌트 당 1

* 일반적으로 시스템은 500TPS 이내인 것이 적절함

* 뱅킹시스템, 통신사 고객정보시스템, 과금시스템 : 1000TPS가 넘음

##### 응답시간

요청한 후 응답을 받을 때까지 소요된 시간

###### 측정하는 위치에 따라

* 클라이언트 응답시간

사용자 요청 후 화면에 나타날 때까지 경과한 시간
클라이언트 내부 처리시간 + 네트워크 응답시간
ㄴ화면 렌더링 시간 + 클라이언트 로직 처리시간

* 네트워크 응답시간

사용자 PC 요청 후 응답이 도착할 때까지 시간

성능 테스트 도구 : HP사 로드러너, HTTP/HTTPS or TP API 모니터 시간
DNS 룩업 시간 + 서비스 업로드/다운로드 네트워크 시간 + 서버 응답 시간

* 서버 응답시간

서버가 요청을 받은 후 처리 결과를 내보내는 시간
웹 액세스로그, 애플리케이션 서버 로그, APM(App Performance Mgmt) 기반 측정 시
웹 서버, 앱 서버, 디비 서버 내의 각 처리시간, 대내외 타 시스템 연계 응답시간

* 연계 응답시간

대네외 연계 서버에 요청을 보내 응답을 받기까지 경과된 시간

연계됬을 경우 전체 응답시간에서 대외기관 응답시간을 구분해서 관리하면:
    성능 분석, 개선 시 접근 방향을 설정하기 위해 중요

연계서버(FEP, ESB) 내 처리시간 + 연계서버 기준 타 시스템의 네트워크 응답+서버 응답시간

가장 정확한 곳은 실 사용자 위치한 곳
성능 개선 시 처리시간을 세분화해 측정할 수 있는 방안이 필요
"아는 만큼 보인다" -> "보이는 만큼 개선가능하다"

* 성능 개선 전문가

성능이 나쁘면 애플리케이션 서버에서 분석을 시작함
로그를 통해 핵심 업무 로직, 앞단 처리/DB 처리, 앱 내부 처리, 연계 처리 속도 구분 가능

애플리케이션 서버와 연계 서버에 대해 세부 응답시간 분석 능력을 갖춰야 함

* 평균의 함정

응답시간이 갈수록 길어지거나, 불규칙적이어도 평균 상으로 정상적으로 보이기가 가능함

* 백분율 응답시간

측정시간 동안 발생한 모든 트랜잭션을 응답시간이 빠른 것보터 줄을 세움
트랜잭션 전체 수 대비 해당 %에 위치한 응답시간을 의미

트랜잭션 응답속도를 가장 빠른 것부터 200개를 세워 180등의 응답시간이 3.5초면 해당 업무의 90% 응답시간은 3.5초임
전체 사용자의 90%가 3.5초 이내 응답시간을 경험할 것이라고 보장함

사용자 입력, 순간적인 시스템 자원 부족 등 예외 상황이 있으므로 100%를 사용하지는 않음

평균 응답시간을 성능 평가로 사용한다면 표준편차, 최솟값, 최대값도 표시해야 성능 판단 가능
일반적으로 표준편처가 평균 응답시간 1/3 이내일 때 의미가 있음

##### 자원

다양한 시스템 구성 요소를 지칭하는 포괄적 용어

서버의 CPU, 메모리, 디스크, 네트워크 자원
WAS 스레드 풀, DB 연결 풀, 힙 메모리, DB 프로세스 수, 오픈 가능한 커서 수, 공유 캐시 메모리 등 물리적 자원
시스템 소프트웨어 설정값

`한정된 값을 가진 시스템 구성 요소` 중 `앱이 동작할 때 사용되는 것`으로, `부족한 경우 사용량 변화에 따라 성능에 영향을 미치는 요소`

목표 성능을 달성할 수 있게 하는 중요 기반요소
성능 평가, 분석 시 자원 사용량 모니터링

###### 평가 관점

* 적정성

자원 사용량에 대한 목표 달성, 부족 여부 확인
부족 시에는 경합, 대기가 발생함
또한 다른 자원에 악영향을 주어 개선 효과를 보지 못할 수 있음
다른 자원 부족의 여파인 경우가 있음

부족 여부를 판단할 때 다른 자원과의 상관관계, 인과관계 파악해 평가할 필요가 있음
(스레드 풀이 부족할 때, CPU가 90% 이상 사용되고 있다면 풀 수를 줄여 CPU를 70% 내외로 만들어 성능 향상 가능)

* 효율성

동일한 업무 수행, 아키텍처 구조가 다를 시 평가 기준은 TPS, 응답시간, 자원 사용량

시스템 구축, 운영 시 효율성은 직접적인 비용에 영향을 미침, BMT(Benchmarking Test)
응답시간을 줄임 : DB 사용을 줄임, App 코드 수행시간을 줄임 -> 시스템 자원을 더 적게 사용하도록 개선

* 안정성

운영시간이 지남에 따라 성능이 저하, 장애 발생 등 문제가 발생하지 않아야 함
메모리, DB 연결 시 누수 : App 재기동하지 않으면 자원 부족으로 장애 발생
데이터 증가-> 응답시간 증가 : 언젠가는 성능 처리로 사용에 불편 발생 가능

시스템 자원에 대한 안정성 평가: 일정 부하가 발생 시 시간이 지나더라도 응답시간이나 자원 사용량이 일정하기 유지되는지 확인

* 가용성

일정 기간(년)동안 시스템이 정상적으로 서비스된 시간 비율
카드 승인시스템, 인터넷 쇼핑몰, 홈쇼핑 송출시스템 등 핵심 기반 시스템 - 장애 시 사업 기회의 손실임
이중화 구성, DB 구축 등에 투자하며 노력함

이중화와 더불어 일부 장비 장애로 가용지원 줄었을 시에도 정상적인 서비스 필요
일부 장애시에도 사용자가 큰 불편 없이 업무 처리 가능한 수준으로 성능 확보 필요

가용성 테스트 시 : 서비스 중단시간, 서비스 안정성 외에 응답시간, TPS, 자언 사용량 변화 등 성능지표 측정해 평가

* 확장성

시스템 사용량 증가에 따라 시스템 증설이 필요할 때 각 자원이 얼마나 용이하게 증설될 수 있는지
향후 처리량과 성능 변화에 따라 유연한 대응이 가능하도록

수직 확장(스케일 업): 사용 중인 서버 내의 주요 자원 증설
사용량 대비 CPU, 메모리 증설이 가능한 빈 슬롯이 얼마나 남았는가?
(DB 서버)

수평 확장(스케일 아웃): 서버 대수를 늘려 처리 용량 확장
서버 내에서 동작하는 소프트웨어가 수평 확장을 지원하는가?
(웹 서버, WAS 서버)