# 성능 테스트

성능 테스트를 알면 성능 개선을 수행할 때 밀접한 도움이 된다.

### 성능 테스트 유형

|유형   |목적   |설명               |
|------|------|-----------------------------------------------------|
|성능   |시스템 성능 목표 달성 여부 평가|`TPS/적정 부하`, `응답시간`, `자원 사용율 만족 여부` 평가, 시스템 테스트 단계에서 수행|
|과부하 |한계 성능 평가, 부족 자원 확인 |과부하 상황에서 시스템의 성능 저하 패턴 분석해 `한계 성능` 평가, 한계 성능하에서 성능 저하, 장애 요인이 된 `부족 자원 확인 및 대비`|
|안정성|응답시간, 자원 사용율 안정성 평가|적정 부하하에서 24시간 이상 지속적으로 테스트 수행, 응답시간, 자원 사용율이 `유지`되는지 평가, 처리 데이터 누적 및 메모리 누수 확인|
|최적화 |성능 개선                        |환경설정, 애플리케이션 튜닝, 시스템 구성요소를 수정해가면서 수행하는 `비교 테스트`, 한번에 한 가지 항목 수정|
|가용성 |일부 시스템 장애 시 서비스 가능성 평가 |서버, 네트워크 장비 등 `하드웨어`, 웹 서버, WAS 등 `소프트웨어`의 일부에 장애 발생 시 처리 데이터 누락 없이 지속적으로 서비스 가능 여부|
|실사용자|실제 성능 평가, 추가 개선 대상 도출   | 실사용자가 일정한 시간 동안 시스템 사용   |
|벤치마크|소프트웨어, 하드웨어 비교 평가        | 여러 제품의 성능 비교테스트  |
|파일럿 |설계 아키텍쳐 검증 |아키텍쳐 설계 후 개발 전 `설계된 아키텍처 기능, 성능 검증`, 중요한 기능별로 몇 개 업무 미리 개발해 검증, 개발자에게 제공할 설치/개발/성능 개선 가이드 보완|
|                      |성능, 안정성, 과부하 테스트 등이 진행됨

### 성능 테스트 구성 요소

* 부하 모델

업무 시나리오, 테스트 데이터, 적용 부하에 대한 설계 모델
성능 테스트 전에 `고객과 부하 모델에 대한 합의 필요`

* 업무 시나리오

최대 부하 시 업무 비중을 기준으로 도출
TPS 기준으로 업무 시나리오 설계
`A 업무 40%, B 업무 30%, C 업무 20%, D/E 업무 5%`
비중이 적더라도 핵심 업무, 중요 업무는 테스트 대상에서 누락되어서는 안됨

* 테스트 데이터

시스템 데이터 : DB 내에 있는 데이터
스크립트 데이터 : 가상 사용자가 사용

* 적용 부하

발생시킬 업무 TPS

* 테스트 환경

하드웨어, 네트워크로 구성된 시스템 성능 테스트 환경
실제 운영환경에서 진행하는 것이 기본임
개발 환경 테스트 환경에서 진행 시 서버 용량을 고려

* 평가 기준

처리량, 응답시간, 자용 사용률
`고객과 합의가 필요`

* 측정 항목

평가용 측정 항목 : 성능 기준 만족 여부
분석용 측정 항목 : 성능 저하 시 발생 위치, 원인 판단
측정 항목 선정 후 측정 방안 수리브 관련 도구 설치

* 부하 발생기

정확한 부하를 발생시키는 성능 테스트 도구

* 가상 사용자

테스트 대상 시스템에 서비스 요청을 보내고 응답을 받는 역할
한 개의 프로세스/스레드

* 테스트 스크립트

가상 사용자가 수행할 스크립트이다.

### 성능테스트 주의사항

##### 테스트 데이터

테스트 DB에 들어 있는 데이터의 양, 패턴이 운영 시 사용할 DB와 동일한지 확인 필요

통상 전체 성능의 70% 이상은 DB에 좌우됨
테스트 대상이 되는 테이블의 데이터 양이나 패턴이 다르면 쿼리 실행계획이 달라짐
데이터가 소량이면 실제 디스크 입출력이 일어나지 않고 메모리에 로드되어 성능이 빠른 것으로 착각할 수 있음
소규모, 신규 구축 시스템일 경우 여의치 않은 경우가 있음

##### 스크립트 데이터

화면 조회, 데이터 처리용으로 수만 개, 수십만 개씩 준비하는 프로젝트가 흔치 않음
수백개~수천개 준비가 일반적

소량의 데이터 사용 시 관련 데이터가 메모리에 캐시되어 초기 구간에 성능이 좋지 않다가 측정 구간에서 좋아질 수 있음
캐시 여부를 고려할 필요가 있음(테스트 시 70% 수준 -> 운영 시작 직후 150% 수준으로 증가될 수 있음)

소량의 데이터 사용 시 처리 결괴 조회 시 조회 건수, 내부 처리 단계에서 처리하는 데이터 건수가 늘어남
테스트 진행할 수록 응답시간이 계속 증가할 수 있음

##### 초기 데이터 제로 테이블

시스템 오픈 시 비어있는 테이블은 시간이 지나며 성능 문제를 일으킴

운영하면서 건수가 큰 폭으로 증가하는 테이블은 테이블 통계정보를 데이터가 쌓여 있을 때의 통계정보로 변경해 달라고 요청해야 함

