# 소스코드 최적화

### 체크리스트

##### 불필요한 작업 제거

단순 정보성 로깅을 하는 부분이 있는가?
로깅을 하지 않을 떄 로깅을 위한 문자열이나 데이터가 만들어지고 있는가?
전문 파싱이나 환경설정 로딩과 같은 작업이 반복 수행되는가?

##### 로직 최적화

락 범위를 최소화하거나 락을 회피할 수 있는가?
집합 데이터에 대한 검색 방식은 적절한가?
문자열 처리에 오버헤드가 존재하는가?
반복 처리 로직이 존재하는가?
기능이 단순한 함수이지만 호출 횟수가 많아 성능에 영향을 미치는가?

##### 적극적인 캐시 사용

영업일, 계정과목, 공통코드 같은 소량 테이블에 빈번한 조회가 발생하는가?
배치 같은 경우 결과가 한정적인 데이터에 반복조회가 많이 있는가?
포털 화면에서 보여지는 게시물 목록 같은 것을 캐시할 수 있는가?

##### 효율적인 아키텍처 구성

프로그램 흐름상에 병목이 존재하는가?
대량건 조회는 가능한가?
송수신 전문 포맷과 크기는 시스템 특성과 네트워크 환경에 적합한가?
한 서비스 내에서 연계 시스템과 빈번하게 통신하는가?

### 소스코드 최적화를 수행할 때 검토해야 할 순서

##### 기반 한경

자바 GC와 같은 기반 환경에 의한 영향도 확인, 성능 저하 요소 제거
자바 GC 시간이 전체 응답시간의 50% 이상이라면 수집된 메서드 간 처리시간 비중을 신뢰할 수 없으므로 GC 개선 작업이 먼저 이뤄져야 함

##### 프레임워크

전문 처리, 트랜잭션 관리, SQL 수행, 로깅, 작업 선/후 처리, 분산 처리, 대외 인터페이스 등 애플리케이션 위한 기본 기능 제공

업무 개발자가 작성하는 코드는 프레임워크 기반 위에서 제공되는 API를 사용해 구현되기 때문에 업무 개발자의 코드 비중이 높지 않음
전체 응답시간에서 DB 처리시간을 제외하면 사실상 프레임워크 수행시간이라고 해도 과언이 아님

##### 공통 모듈

고객정보 조회, 조직정보 조회, 공통코드 조회, 영업일 조회 등 애플리케이션 전반에서 공통으로 사용하기 위해 만ㄷ르어 놓은 모듈
최적화 우선순위가 높음
공통 모듈은 다양한 업무의 요구사항을 수용하기 위해 필요 이상으로 많은 데이터 조회, 이에 집중해서 분석

##### 업무 모듈

개별 어플리케이션 개선 사항이 타 애플리케이션에 공통적으로 적용되는 경우 많음, 개선사항을 정리해 주기적으로 개발자 교육


### 불필요한 작업 제거

#### 로깅

성능 영향도 높은, 수정하는 난이도 낮음
전체 응답시간의 50% 이상이 로깅 코드에서 소요될 수도 있음

##### 잘못 사용된 로깅 수준

Log4j : 전체, 추적, 디버그, 정보, 에러, 심각, 끄기 8개 수준

* 운영 시 : 경고, 에러 수준 로깅

* 추적, 디버그, 정보 성격 로그를 에러, 심각으로 남기지 않음

##### 불필요한 메시지 생성

```java
output = outputFilList.getLData(inx); // 객체도 존재함
LLog.debug.println("이 메시지는 디버그 로깅이 사용되지 않아도 수행됨" + object); // String+object.toString()이 항상 실행됨
if(LLog.debug.isEnabled()){ /*이런 식으로 감싸줘야 함*/}
```

##### 효율적인 로깅 개선

로그를 전체 환경설정 정보보다는 요청에 대한 스레드 컨텍스트 단위로 하도록 개선

서비스 호출 단위로 로그 수준을 설정할 수 있게 하면 됨

##### 트랜잭션 저널 로그

