# 적극적인 성능 확장

성능 튜닝의 한 축은 서비스 간, 서비스 내에서 반복되는 로직을 제거하는 것이다.
결과를 재사용하면 반복되는 로직을 제거할 수 있다.

* 시스템 구성 요소 캐시 사용 예

브라우저:
    * 도메인명 주소
    * 콘텐츠
WAS:
    * 환경설정 개키
    * 프로그램 모듈 캐시
프레임워크:
    * 환경설정
    * 서비스, 프로그램
    * 송수신 전문 구조
    * SQL
    * 애플리케이션 캐시 제공
DBMS:
    * 환경설정
    * 테이블, 인덱스, 권한 등 DB 구성정보
    * SQL 실행계획
    * 데이터 캐시
애플리케이션:
    * 적극적인 사용 요구

캐시 사용은 DB와 동기화 문제를 유발한다.
하지만 시스템 중에는 100% DB와 동기화가 필요하지 않는 부분이 많다.
1분 주기로 게시판 목록을 캐시할 떄 1분간 목록을 본 사용자가 10명이면 목록 조회 부하는 1/10로 감소한다. 인터넷 포털에서 메인 화면에 대한 캐시 사용은 일반화된 기능이다.
상품 팩토리에서 조회된 상품정보를 별도 캐시에 저장할 때, 은행, 보험, 카드사 상품은 실시간으로 바뀌지도 않고 상품 구성정보를 등록하자마자 바로 적용하지도 안흔ㄴ다.
상품이 개발되면 미리 시스템에 등록되고 각 속성 정보는 시작일자/만료일자로 지정된 기간에 따라 적용 어부가 관리된다.
상품 변경 주기, 적용 원칙에 따른 캐시 생명주기를 적절히 관리하면 캐시 적용 가능성이 충분하다.
상품 팩토리는 내부 로직, 쿼리가 복잡해 금융시스템에서 서비스를 처리할 때 상당히 큰 비중을 차지한다.

캐시를 적용할 떄 필요한 시점에 즉시 캐시 초기화, DB와 동기화될 수 있는 구조로 캐시를 만들어야 한다. 상품 팩토리는 적용 기간이 일자 단위로 관리되므로, 24시를 기준으로 캐시가 초기화되는 로직이 필요하다.
공통 코드는 캐시하기 가장 좋은 예로, 공통 코드의 양이 수십만 건 씩 조회되면 사용 빈도가 높은 코드 20~30개를 캐시를 구성해도 적용 효과는 충분히 발휘된다.
채용 시스템의 경우 대학, 학과, 지원분야 등 코드가 한정적이지만 많이 사용되어 큰 효과를 볼 수 있다.

캐시에 많은 데이터를 적재하는 것은 메모리 압박이고, 초기에 모든 데이터를 적재하면 시스템 초기화 시간이 필요해, 사용 시점 시 메모리에 적제하는 지연 로딩 기법을 사요한다.
하지만 공통 코드 중 일부 코드를 캐시하려면 시스템 초기화 시 적재하는 것이 효과적이다. 초기에 전체 데이터를 적재하면 사용하는 시점에서 캐시 데이터에 락 처리할 필요가 없어져 경합이 발생하지 않는다.

캐시를 적극적으로 사용할 것을 권하지만 DB 동기화 문제는 캐시 사용을 제약하는 중요한 요소다.
이러한 문제를 해결하기 위해 캐시 재적재 필요성 여부를 조회하는 테이블을 별도로 두고 캐시를 사용할 때마다 변경 여부를 확인할 수 있다.
캐시 대상 데이터가 산출되는 과정이 간단한, 기본 키 검색을 하는 쿼리 한 개가 수행되는 경우보다 훨씬 무거운 경우에 한해 적용할 수 있다. 캐시 대상 데이터 변경 시 재적재 여부를 확인하는 테이블도 함꼐 변경해야 한다는 오버헤드가 있다.

캐별 프로세스로 구성디는 캐시 솔루션을 사용할 경우가 아니라면 캐시 데이터가 증가해 메모리 부족 유발, GC 시간을 증가해 성능을 떨어뜨리는 요소로 작용할 수 있다. 그래서 캐시를 사용할 떄에는 시스템 전반에 성능 저하를 유발하지 않는 가용 메모리 사용량을 염두에 두고 캐시 데이터 총량을 계산하고 한계를 둬야 한다. 그리고 캐시되는 데이터가 최소화될 수 있게 인스턴스를 구성해야 한다.

WAS 내에서 캐시되는 메모리 양의 대부분은 전문, SQL, 서비스, 프로그램 모듈 정보 등 프레임워크에서 사용하는 메모리가 대부분이다. 이런 메모리는 한 인스턴스에서 처리하는 서비스의 종류가 많으면 많을수록 메모리 사용량이 증가한다. 그래서 인스턴스별로 처리하는 업무 그룹을 분리하면 캐시가 사용하는 메모리 사용량을 절약할 수 있다. 또 전문이나 SQL 정보를 WAS 초기화 때 한 번에 로딩하는 것 보다 처음 사용하는 시점에 로딩하면 메모리 사용량을 줄일 수 있다.