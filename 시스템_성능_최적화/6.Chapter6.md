# 상황별 분석 단계

DB 서버의 CPU 사용율 80% 이상인 상황을 분석
응답 시간이 느릴 시 어디가 느린지 찾아내려면 무엇을 확인해야 하는가?

* 시스템 중요 자원의 사용량 확인, 부족 여부 확인

* 애플리케이션 서버에서 스택을 다수 수집, 각 유관 서버와 애플리케이션 코드의 성능 비중 분석

* 스택 분석

### 화면 응답시간 저하

80% 이상은 시스템 내부 문제이므로 서버 내부의 처리 지연 여부 확인

* 클라이언트 자원 사용량 확인

* 사용자 접점 서버단 패킷 수집

* 클라이언트 응답시간 분석

* 클라이언트 원인 분석

* 네트워크 원인 분석

### 시스템 내 응답시간 저하

가장 먼저 APM을 확인, 서버 중요 자원 사용량/서비스 느려진 위치(DB, App내부) 확인
APM이 없다면 앱 서버에서 수집한 스택 분석

* 애플리케이션 서버 응답시간 분석

* 채널/웹 서버 원인 분석

* DB 서버 원인 분석

* 연계 서버 원인 분석

* 애플리케이션 내부 원인 분석

### 서비스 멈춤 현상

프로세스가 거의 멈춘 상태로 더 이상 사용자 요청을 처리하지 못하는 경우
자원 부족여부 확인 후 애플리케이션 상태 확인

서버 자원은 CPU 사용량, 메모리 스와핑 여부 확인
DB 서버는 데이터 캐시 영역이 스왑 영역으로 내려가면 급격한 성능 저하 발생
자바 프로세스는 Full GC로 멈출 수 있으므로 먼저 GC 상태 모니터링

자원에 문제가 없을 시 애플리케이션 스택이 핵심 정보임
락 영향도, 현재 수행 중인 기능, 작업 스레드 소진 등에 관한 정보 습득 가능
시스템 콜 모니터링 : 해당 애플리케이션이 완전히 멈춰있는지, 동작하고 있지만 너무 느려 멈춰있는 것처럼 보이는지

완전히 멈춘 경우:
DB에서 대량 테이블에 대해 전체 테이블 탐색 수행한 경우
애플리케이션이 무한 반복에 빠진 경우

* 애플리케이션 스택 분석

### 시스템 전반에 걸친 성능 개선

특정 애플리케이션이 아닌 시스템 전체에 대한 성능 개선 진행

대상 애플리케이션, SQL을 식별하는 것이 우선
수행 빈도, 총 수행시간이라는 측면에서 비중이 가장 높은 것부터 개선 가능성 검토

전문 파싱, 전문 생성 등 가볍지 않은 기능이 자원 측면에 큰 영향을 줌
수행 빈도를 줄일 수 있는 방안 강구 필요

SQL은 사용 블록 수의 합이 가장 큰 것들을 대상
SQL 튜닝의 핵심은 동일한 결과를 얻지만 더 작은 블록을 사용하게 하는 것

APM, DB 모니터링 도구 등 수행 통계를 제공하는 솔루션이 있으면 수월함
여의치 않으면 스택을 수집해 성능 통계를 만들어야 함

### 서버 자원 사용량 확인


