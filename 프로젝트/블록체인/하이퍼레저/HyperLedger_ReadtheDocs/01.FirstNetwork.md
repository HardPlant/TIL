# Build First Network

[](http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html)

`cd fabric-samples/first-network`

* 실행하기

`byfn.sh` 파일을 제공했다. 이 파일은 다른 기관 두 개와 주문자 노드를 나타내는 피어 4개가 있는 Fabric network를 부트한다.
그리고 컨테이너를 실행하고, 안에서 스크립트가 피어들을 채널에 들어오게 하고 체인코드를 배포하고 인스턴스화한다. 그리고 트랜잭션을 배포된 체인코드가 실행시킨다.

채널 이름을 고르지 않으면 기본 값 `mychannel`이 설정된다.

## Generate Network Artifcats

`./byfn.sh -m generate`

```bash
##### Generate certificates using cryptogen tool #########
#########  Generating Orderer Genesis block ##############
### Generating channel configuration transaction 'channel.tx' ###
#######    Generating anchor peer update for Org1MSP   ##########
#######    Generating anchor peer update for Org2MSP   ##########
```

첫 번째 단계로 모든 증명서와 키를 모든 네트워크 개체들을 위해 생성했다.
그리고 `genesis block`이 주문 서비스를 위해 사용되었고, [채널](http://hyperledger-fabric.readthedocs.io/en/latest/glossary.html#channel)을 형성하기 위해 설정 트랜잭션에 사용되었다.

```txt
채널은 사설 블록체인으로, 데이터 고립화와 기밀성을 유지시켜준다.
채널 특정 장부는 채널 안에 있는 피어들 사이에 공유되고, 거래하는 파티들은 거래할 채널에 적절하기 인증해야 한다.
```

## Bring up the Network

Go : `./byfn.sh -m up`
Node : `./byfn.sh -m up -l node`

이 커맨드는 Golang 체인코드 이미지를 컴파일하고 해당하는 컨테이너를 구동한다.
`Go`는 기본 체인코드 언어지만, Node.js 체인코드를 만들 수도 있다.

```bash

 ____    _____      _      ____    _____
/ ___|  |_   _|    / \    |  _ \  |_   _|
\___ \    | |     / _ \   | |_) |   | |
 ___) |   | |    / ___ \  |  _ <    | |
|____/    |_|   /_/   \_\ |_| \_\   |_|

Channel name : mychannel
Creating channel...
```

로그는 여기서부터 시작된다. 컨테이너들을 모두 구동하고, 완전한 엔드-투-엔드 애플리케이션 시나리오를 실행한다. 성공적으로 완료되었다면

```txt
===================== All GOOD, BYFN execution completed =====================


 _____   _   _   ____
| ____| | \ | | |  _ \
|  _|   |  \| | | | | |
| |___  | |\  | | |_| |
|_____| |_| \_| |____/
```

메시지를 출력한다. 스크롤해서 다양한 트랜잭션을 확인할 수 있다.
순서는
    채널을 만든다.
    모든 피어가 채널에 들어오도록 한다.
    [peer0.org1, peer1.org1, peer0.org2, peer1.org2]
    채널에서 Org1MSP, Org2MSP 앵커 피어를 업데이트한다.
    체인코드가 피어들에게 설치된다.
    peer0.org1의 트랜잭션이 성사된다.
    peer1.org2에 대한 쿼리를 진행한다.

## Bring Down the network

`./byfn.sh -m down`

정리를 진행한다.

아래부터는 기본 툴링, 부트스크랩 메커니즘에 대해 설명한다.

## Crypto Generator

`cryptogen`툴은 네트워크의 다양한 개체를 위해 x509 인증서를 만들어낸다.
이 인증서는 id를 나타내며 개태들의 통신/거래 때 서명/검증을 수행할 수 있다.

### 작동방식

```yaml

OrdererOrgs:
  # ---------------------------------------------------------------------------
  # Orderer
  # ---------------------------------------------------------------------------
  - Name: Orderer
    Domain: example.com
    Specs:
      - Hostname: orderer
# ---------------------------------------------------------------------------
# "PeerOrgs" - Definition of organizations managing peer nodes
# ---------------------------------------------------------------------------
PeerOrgs:
  - Name: Org1
    Domain: org1.example.com
    EnableNodeOUs: true

    Template:
      Count: 2
    Users:
      Count: 1
  - Name: Org2
    Domain: org2.example.com
    EnableNodeOUs: true
    Template:
      Count: 2
    Users:
      Count: 1
```

Cryptogen은 `crypto-config.yaml`을 사용한다.
이 설정파일은 네트워크 토폴로지를 포함하고 있어 조직과 조직에 속하는 요소들을 위해 인증서와 키들을 생성할 수 있다.
각 조직은 고유한 루트 인증서(ca-cert)가 제공되어, 동료/주문자 등 특정 요소를 해당 조직에 바인딩한다.
각 조직에 고유 CA 인증서를 할당함으로서, 우리는 참여하는 멤버가 자체 Certificate Authority를 사용하고 있는 전통적인 네트워크를 모방한다.
Fabric에서 작동하는 트랜잭션과 통신은 개인키로 서명되고(`keystore`), 공개키를 사용해 확인한다.(`signcerts`)

파일에는 `count` 변수가 있다. 이 값은 Org에 있는 Peer 수를 정하는 데 쓴다.
툴을 실행하기 전에 `Name`,`Domain`,`OrdererOrgs` 헤더에 있는`Spec` 파라미터를 보자.

각 네트워크 개체에 적용되는 네이밍 컨벤션은 다음과 같다.
"{{.Hostname}}.{{.Domain}}"
그래서 순서 노드를 참조점으로 사용해, `Orderer` MSP ID에 연결된`orderer.example.com` 오더링 노드가 남는다.
이 파일은 상세한 설명이 되어 있다. MSP

`cryptogen` 툴을 사용한 뒤, 생성된 인증서 및 키는 `crypto-config` 폴더에 저장된다.

## Configuration Transaction Generator

## Run the tools

### Manaually generate the artifacts

### Create a Channel Configuration Transaction

## Start the network

## Create & Join Channel

## Update the anchor peers

## Install & Instantiate Chaincode

## Query

## Invoke

## Query_2