# 메일 서버

## 메일 프로토콜

SMTP : Client가 메일 보내기 / 메일 서버끼리 메일 주고받기
POP3 : 메일 서버에서 메일 가져오기
IMAP : POP3

## 센드메일 서버 구축

서버 A는 mail.daum.net, 서버 B는 mail.paran.com을 사용하도록 하겠다.

* 호스트 설정

서버 A :
`yum -y install sendmail`로 메일 서버를 설치한다.
`/etc/hosts`에 `192.168.xxx.100 mail.paran.com`을 추가한다.
`/etc/sysconfig/network` 파일에 `"HOSTNAME=mail.paran.com"`을 덧붙인다.
`/etc/mail/local-host-names` 파일에  `mail.paran.com`을 추가한다.

서버 B도 동일하게, `mail.daum.net`으로 만든다.

* 도메인 네임 서버 설정

`/etc/named.conf` 파일에서

```bash
zone "paran.com" IN {
    type master;
    file "paran.com.db";
}
zone "daum.net" IN {
    type master;
    file "daum.net.db";
}
```

이후 `/var/named`에서

```bash
$TTL 3H # 다른 네임 서버가 해당 주소를 캐시에 저장하는 시간
@   SOA @   root.(2 1D  1H  1W  1H) # @ : 도메인 이름(/etc/named.conf 내의 john.com)
    IN  NS  @   # NS : NameServer, MX: Mail Server, A: 대응되는 IP주소
    IN  A   192.168.xxx.100 #CNAME : 별칭
    IN  MX  10  mail.paran.com.

mail IN  A   192.168.240.100
```

을 설정한다. daum.net 메일 서버도 동일하게 설정한 뒤, 
`named-checkconf /etc/named.conf`
`named-checkzone paran.com /var/named/paran.com.db`
`named-checkzone daum.net /var/named/daum.net.db`
등도 동일하게 설정한다. 이후 `service named restart` 명령을 실행한다.

메일 설정 시에 `chown root.named ./paran.com.db ./daum.net.db`로 권한 설정을 해 주어야 정상적으로 작동한다.

* 메일 서버 구축

`yum install sendmail-cf dovecot`

* 설정 파일 수정

`/etc/mail/sendmail.cf`

```bash
85: Cwlocalhost -> Cwparan.com
261: O DaemonPortOptions=Port=smtp, Name=MTA #, Addr= #
```

`/etc/mail/access`

외부 네트워크, 호스트가 메일을 보낼 수 있도록 허가

```bash
paran.com   RELAY
daum.net    RELAY
192.168.240 RELAY
```