# 파이어베이스 인증
* FirebaseUI
https://github.com/firebase/FirebaseUI-Android
https://github.com/firebase/FirebaseUI-Android/blob/master/auth/README.md
로그인 과정을 오픈소스로 제공

* 설정
콘솔의 [Authentication] -> [로그인 방법] 에서 설정 가능

* 순서
    - 의존성 추가
        FirebaseUI는 Firebase 버전에 따라 Dependancy가 있으므로 README에서 제대로 확인해야 됨.
    - AuthStateListener 추가 (sign in, log in/out)
    - Send unathenticated users to sign in flow
    - Sign in set up / sign out tear down

* AuthStateListener
    - 인증 상태 변경 시 반응
        로그인
        로그아웃
        FirebaseAuth에 연결
        (로그인 취소 시)
    - 상태에 따라 유저에게 보여줄 것 결정
    
    - onResume()에 attach : 앱이 시작, 표시될 때
    - onPause()에 detach : 앱이 보이지 않을 떄

    - 이 시기를 결정하는 게 중요함
        다수의 Activity에 영향 :
        - Main : 로그인 시
        - Signin : 로그아웃 시

    - 한 개 이상의 Listener 동시에 attach하지 않도록 주의

* 예제 
    - SignOut : 로그인 스크린 표시
    - SignIn : Toast 메시지

    - 멤버 변수 추가
```java
private FirebaseAuth mFirebaseAuth;
private FirebaseAuth.AuthStateListener mAuthStateListener;
```

    - 초기화 : onCreate()
```java
    mFirebaseAuth = FirebaseAuth.getInstance();
    ...
    mAuthStateListener = new FirebaseAuth.AuthStateListener();
```
    
    - onResume(), onPause()에 add, remove 추가
```java
    protected void onPause() {super.onPause();
        mFirebaseAuth.removeAuthStateListener(mAuthStateListener);}
    protected void onResume() {super.onResume();
        mFirebaseAuth.addAuthStateListener(mAuthStateListener);}
```
    - 리스너 수정
```java
            public void onAuthStateChanged(@NonNull FirebaseAuth firebaseAuth) {
                FirebaseUser user = firebaseAuth.getCurrentUser();
                if (user != null){ // SignOut 상태

                } else{ // SignIn 상태

                }
            }
```

        해당 상태에 따른 활동 추가
```java
+                if (user != null) {
+                    // User is signed in
+                    Toast.makeText(MainActivity.this, "You're now signed in. Welcome to FriendlyChat.", Toast.LENGTH_SHORT).show();
+                } else {
+                    // User is signed out
+                    startActivityForResult(
+                            AuthUI.getInstance()
+                                    .createSignInIntentBuilder()
+                                    .setIsSmartLockEnabled(false)
+                                    .setProviders(
+                                            AuthUI.EMAIL_PROVIDER,
+                                            AuthUI.GOOGLE_PROVIDER)
+                                    .build(),
+                            RC_SIGN_IN);
+                }
```
[예제](https://github.com/firebase/FirebaseUI-Android/blob/master/auth/README.md)에서 복사 후 필요한대로 지워서 사용, RC_SIGN_IN = 아무 request code 값