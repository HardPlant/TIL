# 네트워크 스캐닝

## 준비활동

풋프린팅 -> 스캐닝 -> 목록화

풋프린팅: 신문, 게시판, 네트워크 검색, 포털 검색 등 통해 공격 대상의 IP 블록, DNS/Mail 서버 등 정보 수집
스캐닝: Ping, Port Scan, 운영체제 확인 등 방법으로 시스템 종류, IP 주소, 서비스 등을 알아냄
목록화: 수집된 정보를 토대로 라우팅 테이블, SNMP 정보 등 좀 더 실용적인 정보를 수집해 시스템 취약점 분석 및 공격방법 결정

## 풋 프린팅

사회공학 기법 사용, IP 블록, 사용자 이름/계정, 전화번호 등 정보 수집

## 스캔 공격 분류

* 네트워크의 보안장비 사용 현황, 우회 가능 네트워크 구조, 해당 네트워크 내의 시스템 플랫폼 형태, 시스템 운영체제의 커널 버전 종류, 제공 서비스의 종류 등 정보를 알 수 있음

* 네트워크에 대한 직접적인 침투경로, 우회경로 정보 등 파악 가능, 이 중 취약점이 있는 서비스 제공하는 시스템 있을 시 공격 성공 가능

## 포트 스캔 종류

Sweep : 네트워크 구조 조사(시스템에 대한 작동 유무 판단)
Open Scan, Stealth Scan : 시스템에서 제공되는 서비스를 확인
Security Scan : 보안장비에 대한 우회, 공격자 신분을 감춤

### Sweep

목표 대상 기관에서 사용하는 IP 주소, 네트워크 범위를 알아낸다.

* ICMP Sweep

ping 프로그램을 사용한다.

* TCP Sweep

ACK, SYN 패킷을 보낸다.
대부분의 시스템이 사용하는 21(FTP),22(SSH), 23(Telnet), 25(SMTP), 80(HTTP)가 적당하다.

* UDP Sweep

TCP가 복잡하고 느리거나 필요하지 않을 경우 유용하다.
ICMP Port Unreachable을 이용해, 해당 포트에서 Port Unreachable이 반환되면 포트가 열려진 것이다.

### Open Scan

시스템의 활성화 여부, 스캔하는 포트에 해당되는 서비스의 활성화 여부를 조사한다.

* TCP Scan

    SYN 패킷을 보낸 뒤, 열려 있으면 SYN+ACK, 닫혀 있으면 RST+ACK가 반환된다.

  * Reverse Ident

    세션 성립 상태에서 원격지 서버에서 데몬을 실행하고 있는 프로세스의 소유권자를 확인함

  * TCP Full Open

    SYN+ACK가 연결된 이후 ACK를 보내 연결을 완료한다.
    신뢰성 있는 결과를 맺을 수 있으나 속도가 느리고 로그가 남는다.

  * TCP Half Open

    SYN+ACK 이후 RST를 보낸다.
    공격자는 RST를 즉시 보내야 한다.

* UDP Scan

    포트가 열려 있을 경우 아무 응답이 없고, 닫혀 있을 경우 ICMP Unreachable을 받는다.
    결과를 신뢰하기 어렵다.

### Stealth Scan

TCP 헤더를 조작해 특수한 패킷을 만든 후 스캔 대상 시스템에 보내 응답으로 포트 활성화 여부를 알아낸다.

FIN, ACK, 단편화 스캔 등이 있다.

* FIN, NULL, XMAS

    FIN : 포트가 열려 있으면 응답이 없고, 닫혀 있으면 RST가 돌아온다.
    NULL, XMAS(모든 패킷) 또한 같다.

* ACK

    모든 포트에 ACK 패킷 수천 개를 전송해 RST 패킷의 TTL과 윈도우 필드를 분석한다.
    수신한 RST의 TTL 값이 64 이하, 윈도우 크기가 0이 아닐 경우 열려있다.
    닫혀있는 경우 TTL 값은 운영체제에 대해 일정하게 큰 값, 윈도우의 크기가 0인 RST 패킷이 돌아온다.

* TCP 단편화

    TCP 헤더의 크기 20바이트를 두 개의 패킷을 나누어 전송한다.
    첫 번째 패킷에는 출발지 IP, 도착지 IP 주소를 저장하고, 두 번째 패킷에는 스캔 포트를 저장한다.
    첫 번째 패킷에 TCP 포트에 대한 정보가 없으므로 통과, 두 번째 패킷은 IP 정보가 없기 때문에 통과한다.
    침입탐지시스템, 네트워크 필터링을 피할 수 있으나 대상 시스템에서 패킷을 재조합하는 동안 네트워크와 커널에서 로드 문제가 발생할 수 있다.

## 대표적인 스캔 도구

### NMap

운영체제의 종류, 사용 서비스 FTP 서버 취약점은 이용판 bounce 공격을 수행할 수 있다.

* 사용법

\- s[S|T|U|F|X|N|A] :
\- b : FTP bounce

* Port Option

\-p [port name, service, T: / U: ]

* Output Option

\-v, \-vv

\-d

\-[N,X(ML),G(grepable),A(directory(.nmap,.xml,.gnmap으로 동시출력))]

\-O (운영체제 정보)
\-F (빠른 스캐닝)
\-T(0~5, 0-느리ㅔ)

### LANGuard

네트워크 트래픽 분석, 호스트 운영체제 파악, 사용 중인 포트 및 공유 서비스 검색 등을 수행하는 윈도우즈용 스캐너이다.
일부 운영체제를 대상으로 크래킹도 할 수 있다.

### 기타

Spoofscan.c : 스니핑, 스푸핑 스캐닝
Fragrouter : 패킷 단편화
IDES.c : 데이터 스트림에 RST 등패 킷 추가
Firewalk : ACL 평가 도구, 필터링되는 포트 인식 위해 TTL 분석 사용
HPING : 특별한 TCP 보내고 분석
SING : 특별한 ICMP 보내고 분석

## 운영체제 탐지

### 배너 그리빙

원격지 시스템에 로그인하면 뜨는 안내문을 확인한다.

### TCP/IP

TCP/IP에 대한 운영체제의 반응을 본다.

* FIN 스캔 : 적용되면 윈도우, BSD, Cisco, IRIS 등이다.

* 세션 연결 시 TCP 패킷의 시퀀스 넘버 생성을 관찰한다.

    윈도우 : 시간
    리눅스 : 완전한 랜덤
    FreeBSD, Digital-UNIX, IRIX, Solaris : 시간에 따른 랜덤 증분

## 목록화

풋 프린팅, 스캐닝 작업을 통해 수집한 정보를 바탕으로 좀 더 실용적인 정보를 얻는 과정이다.

공유 자원 목록화, 사용자 및 그룹 목록화, 응용 프로그램 목록화로 구분된다.

### 공유자원 목록화

네트워크를 통해 공유된 파일, 프린터 같은 자원이다.
운영체제에 따라 다른 목록화 기법(NFS, NetBIOS)을 사용한다.

### 사용자 및 그룹 목록화

공격대상 시스템이 결정되었다면, 그 시스템을 사용하는 사용자, 그룹의 정보를 목록화한다.
자주 접속하지 않는 사용자 계정, 관리자 권한으로 접근이 가능한 그룹 아이디를 찾을 수 있도록 목록화한다.

### 응용프로그램 목록화

운영체제, 네트워크 서비스, 사용 중인 포트, 커널 버전 등 취약점을 발견할 수 있는 자원을 목록화한다.

대부분의 목록화는 스캔 결과를 바탕으로 정보를 도식화해 공격자에게 공격할 수 있는 정보, 경로를 제공하며 공격자는 목록화된 자료를 바탕으로 가장 취약한 부분을 공격하게 된다.