# 인터럽트

## 인터럽트 구조와 동작

* 인터럽트 개념

PC를 스택에 저장했다 꺼냄

* 인터럽트 구조

IE [EA | X | ET2 | ES | ET1 | EX1 | ET0 | EX0]

SFR 영역에 IE, IP, TCON, SCON 레지스터 등이 있음
IE : 인터럽트 EN/D
Ip : 인터럽트 소스 간 우선순위를 결정함

* 인터럽트 우선순위

IP [ X | X | PT2 | PS | PT1 | PT0 | PX0]

1 => 높은 레벨, 0 = 낮은 레벨

* 인터럽트 동작

PC 저장 -> ISR로 이동 -> 수행 -> PC 복귀

벡터 어드레스 : ISR로 이동
사이에 공간이 없으므로, 보통 JMP 명령을 쓰게 됨

## 외부 인터럽트

* TCON 하위 4비트 (사우이 4비트는 타이머에서 사용)

1 : 에지 트리거 (falling edge)
0 : 레벨 트리거 (rising edge)

외부 인터럽트 제어 (T), 에지(E)로 나뉨
머신 사이클마다 검사되므로 12클록을 유지해야 함

## 타이머/카운터 인터럽트

* TMOD 레지스터

타이머 카운터 레지스터 (TH1, TL1) 오버플로우 시 TCON의 TF가 1이 됨

타이머/카운터 1 => 직렬 보트 보레이트 발생기로 사용되기도 함
모드
M0:
M1:
0 : 13비트 타이머/카운터
1 : 16비트 타이머/카운터 (TH, TL 사용)
2 : 
3 : 타이머 0 : 2개의 8비트 타이머, 타이머 1 : 직렬 포트의 보레이트 발생기
C/ NOT T : 1이면 카운터 모드로 동작함 (T0L:P3.4, T1:P3.5) 펄스를 카운트함
GATE -> 외부에서 제어, INTO(P3.2, P3.3)일 이용해 타이머 제어

TMOD = 0x20; 0010 0000
TF1 = 0; 인터럽트 플래그 클리어
TH1 = 0x38; (256 - 200) :
TL1 = 0x38;
IE = 0x88; 1000 1000 : 전체 ENABLE, 타이머 1 ENABLE
IP = 0x08; 0000 1000 : 타이머 1 우선순위 높게 설정
TR1 = 1; // run

* TCON 레지스터

TCON 상위 4비트 (하위는 외부 인터럽트임)
TF : 타이머 오버플로우시
TR : 카운터 시작 (1), Timer Run

* 인터럽트는 외부 또는 내부로부터 CPU가

* 8051에는 외부 인터럽트 2개, 타이머/카운터 인터럽트 2개, 직렬 포트 인터럽트 1개 총 5개 인터럽트가 있다.

* 벡터 어드레스는 인터럽트 발생 시점프하는 곳으로, 이곳에는 인터럽트 서비스 루틴의 시작 어드레스로 점프하라는 명령이 들어있따.

* 